<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Sistema UGC</title>
<link rel="icon" type="image/png" href="./logo.png">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
}

.login-container {
background: white;
border-radius: 15px;
box-shadow: 0 12px 48px rgba(0,0,0,0.4);
max-width: 450px;
width: 100%;
overflow: hidden;
animation: slideIn 0.3s ease;
}

@keyframes slideIn {
from {
transform: translateY(-50px);
opacity: 0;
}
to {
transform: translateY(0);
opacity: 1;
}
}

.login-header {
background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
color: white;
padding: 40px 30px;
text-align: center;
}

.login-header img {
width: 80px;
height: 80px;
margin-bottom: 15px;
}

.login-header h1 {
font-size: 1.8em;
margin-bottom: 5px;
}

.login-header p {
color: #4a9eff;
font-size: 0.95em;
}

.login-body {
padding: 40px 30px;
}

.alert {
padding: 15px 20px;
border-radius: 8px;
margin-bottom: 20px;
display: none;
animation: shake 0.3s;
}

@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-10px); }
75% { transform: translateX(10px); }
}

.alert-error {
background: #f8d7da;
color: #721c24;
border-left: 4px solid #dc2626;
}

.alert-success {
background: #d4edda;
color: #155724;
border-left: 4px solid #28a745;
}

.form-group {
margin-bottom: 25px;
}

.form-group label {
display: block;
margin-bottom: 8px;
color: #000000;
font-weight: 600;
font-size: 0.95em;
}

.form-group input {
width: 100%;
padding: 12px;
border: 2px solid #ddd;
border-radius: 8px;
font-size: 1em;
transition: all 0.3s;
font-family: inherit;
}

.form-group input:focus {
outline: none;
border-color: #2a5298;
box-shadow: 0 0 0 3px rgba(42,82,152,0.1);
}

.password-container {
position: relative;
}

.toggle-password {
position: absolute;
right: 15px;
top: 50%;
transform: translateY(-50%);
cursor: pointer;
color: #666;
font-size: 1.2em;
user-select: none;
transition: color 0.3s;
}

.toggle-password:hover {
color: #2a5298;
}

.btn-login {
width: 100%;
padding: 12px 30px;
background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
color: white;
border: none;
border-radius: 8px;
font-size: 1em;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
margin-top: 10px;
}

.btn-login:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(42,82,152,0.4);
}

.btn-login:active {
transform: translateY(0);
}

.btn-login:disabled {
background: #9ca3af;
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.login-footer {
text-align: center;
padding: 20px;
background: #f8f9fa;
border-top: 1px solid #eee;
}

.login-footer p {
color: #666;
font-size: 0.85em;
}

.login-footer p:first-child {
color: #000000;
font-weight: 600;
}

.loading {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255,255,255,.3);
border-radius: 50%;
border-top-color: white;
animation: spin 0.8s linear infinite;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

@media (max-width: 480px) {
.login-header {
padding: 30px 20px;
}

.login-header h1 {
font-size: 1.5em;
}

.login-body {
padding: 30px 20px;
}
}
</style>
</head>
<body>

<div class="login-container">
<div class="login-header">
<img src="./logo.png" alt="Logo CENSA" onerror="this.style.display='none'">
<h1>Inicio de Sesi√≥n</h1>
<p>Sistema de Gesti√≥n de Convivencia</p>
</div>

<div class="login-body">
<div class="alert alert-error" id="alertError">
<strong>‚ùå Error:</strong> <span id="errorMessage"></span>
</div>

<div class="alert alert-success" id="alertSuccess">
<strong>‚úÖ Acceso concedido</strong>
</div>

<form id="loginForm">
<div class="form-group">
<label for="usuario">üë§ Usuario</label>
<input 
type="text" 
id="usuario" 
placeholder="Ingrese su usuario"
required
autocomplete="username"
>
</div>

<div class="form-group">
<label for="password">üîë Contrase√±a</label>
<div class="password-container">
<input 
type="password" 
id="password" 
placeholder="Ingrese su contrase√±a"
required
autocomplete="current-password"
>
<span class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</span>
</div>
</div>

<button type="submit" class="btn-login" id="btnLogin">
Iniciar Sesi√≥n
</button>
</form>
</div>

<div class="login-footer">
<p>¬© 2026 Polit√©cnico Nuestra Sra. De la Altagracia</p>
<p style="margin-top: 5px; font-size: 0.8em;">Unidad de Gesti√≥n de Convivencia</p>
</div>
</div>

<script>
// ==========================================
// CONFIGURACI√ìN DE USUARIOS DESDE GOOGLE SHEETS
// ==========================================

// URL del Google Apps Script para cargar usuarios
const URL_USUARIOS = 'https://script.google.com/macros/s/AKfycbw1JHR4u7TBBRCOwKG5HQTklbujX8mGEavpCyOQKCL-0mPvnFiHCVlyrspvZmZbgei0/exec';

// Cache de usuarios
let USUARIOS_CACHE = null;

// Cargar usuarios desde Google Sheets
async function cargarUsuarios() {
try {
console.log('üì• Cargando usuarios desde Google Sheets...');
const response = await fetch(URL_USUARIOS);
if (!response.ok) throw new Error('Error al cargar usuarios');

const data = await response.json();
console.log('‚úÖ Usuarios cargados:', data.length);
console.log('üîç DATOS RECIBIDOS:', data);

// Convertir array a objeto para f√°cil b√∫squeda
const usuariosObj = {};
data.forEach(user => {
console.log('üîç Usuario raw:', user);

// Buscar el campo de usuario en diferentes posibles nombres
const username = user.Usuario || user.usuario || user.USUARIO;
const password = user.Contrase√±a || user['Contrase√±a'] || user.contrase√±a || user.password || user.Password;
const nombreCompleto = user['Nombre Completo'] || user.Nombre || user.nombre || user.NombreCompleto;
const cargo = user.Cargo || user.cargo || user.CARGO;
const tipo = user.Tipo || user.tipo || user.TIPO || user.Rol || user.rol;

console.log('üîç Campos extra√≠dos:', {
username,
password,
nombreCompleto,
cargo,
tipo
});

if (username) {
usuariosObj[username.toLowerCase()] = {
password: String(password), // Convertir a string
rol: tipo,
nombre: nombreCompleto,
cargo: cargo
};
}
});

console.log('üîç USUARIOS FINALES:', usuariosObj);
console.log('üîç USUARIOS DISPONIBLES:', Object.keys(usuariosObj));

// AGREGAR USUARIOS DE RESPALDO SIEMPRE (por si Google Sheets no los tiene)
const usuariosRespaldo = {
'jpaulino': {
password: 'admin123',
rol: 'administrador',
nombre: 'Juana Paulino',
cargo: 'Administrador del Sistema'
},
'wcaraballo': {
password: 'consultaw123',
rol: 'consulta',
nombre: 'Wenlly Caraballo',
cargo: 'Director Acad√©mico'
},
'gduran': {
password: 'consultag123',
rol: 'consulta',
nombre: 'Glennys M. Dur√°n',
cargo: 'Coordinadora Pedag√≥gica'
},
'ybatista': {
password: 'consultay123',
rol: 'consulta',
nombre: 'Yernibel Batista',
cargo: 'Directora Regente'
},
'afernandez': {
password: 'consultaa123',
rol: 'consulta',
nombre: 'Anabel Fern√°ndez',
cargo: 'Orientadora Escolar'
}
};

// Combinar usuarios de Sheets + usuarios de respaldo
const usuariosFinales = { ...usuariosRespaldo, ...usuariosObj };
console.log('üîç TOTAL USUARIOS (Sheets + Respaldo):', Object.keys(usuariosFinales));

USUARIOS_CACHE = usuariosFinales;
return usuariosFinales;
} catch (error) {
console.error('‚ùå Error cargando usuarios:', error);

// USUARIOS DE RESPALDO (fallback)
return {
'jpaulino': {
password: 'admin123',
rol: 'administrador',
nombre: 'Juana Paulino',
cargo: 'Administrador del Sistema'
},
'wcaraballo': {
password: 'consultaw123',
rol: 'consulta',
nombre: 'Wenlly Caraballo',
cargo: 'Director Acad√©mico'
},
'gduran': {
password: 'consultag123',
rol: 'consulta',
nombre: 'Glennys M. Dur√°n',
cargo: 'Coordinadora Pedag√≥gica'
},
'ybatista': {
password: 'consultay123',
rol: 'consulta',
nombre: 'Yernibel Batista',
cargo: 'Directora Regente'
},
'afernandez': {
password: 'consultaa123',
rol: 'consulta',
nombre: 'Anabel Fern√°ndez',
cargo: 'Orientadora Escolar'
}
};
}
}

// ==========================================
// FUNCI√ìN DE LOGIN
// ==========================================

document.getElementById('loginForm').addEventListener('submit', async function(e) {
e.preventDefault();

const usuario = document.getElementById('usuario').value.trim().toLowerCase();
const password = document.getElementById('password').value;

const btnLogin = document.getElementById('btnLogin');
const alertError = document.getElementById('alertError');
const alertSuccess = document.getElementById('alertSuccess');

alertError.style.display = 'none';
alertSuccess.style.display = 'none';

if (!usuario || !password) {
mostrarError('Por favor complete todos los campos');
return;
}

btnLogin.disabled = true;
btnLogin.innerHTML = '<span class="loading"></span> Verificando...';

try {
// Cargar usuarios desde Google Sheets
const USUARIOS = await cargarUsuarios();

if (!USUARIOS[usuario]) {
mostrarError('Usuario no encontrado');
btnLogin.disabled = false;
btnLogin.innerHTML = 'Iniciar Sesi√≥n';
return;
}

if (USUARIOS[usuario].password !== password) {
mostrarError('Contrase√±a incorrecta');
btnLogin.disabled = false;
btnLogin.innerHTML = 'Iniciar Sesi√≥n';
return;
}

const datosUsuario = {
usuario: usuario,
rol: USUARIOS[usuario].rol,
nombre: USUARIOS[usuario].nombre,
cargo: USUARIOS[usuario].cargo,
loginTime: new Date().toISOString()
};

localStorage.setItem('usuarioUGC', JSON.stringify(datosUsuario));

alertSuccess.style.display = 'block';
btnLogin.innerHTML = '‚úÖ Acceso concedido';

console.log('‚úÖ Login exitoso:', datosUsuario);

setTimeout(() => {
if (datosUsuario.rol === 'administrador') {
window.location.href = 'admin.html';
} else if (datosUsuario.rol === 'consulta') {
window.location.href = 'consulta.html';
}
}, 1000);

} catch (error) {
console.error('‚ùå Error en login:', error);
mostrarError('Error al verificar credenciales. Intente nuevamente.');
btnLogin.disabled = false;
btnLogin.innerHTML = 'Iniciar Sesi√≥n';
}
});

// ==========================================
// FUNCIONES AUXILIARES
// ==========================================

function mostrarError(mensaje) {
const alertError = document.getElementById('alertError');
document.getElementById('errorMessage').textContent = mensaje;
alertError.style.display = 'block';
}

function togglePassword() {
const passwordInput = document.getElementById('password');
const toggleIcon = document.querySelector('.toggle-password');

if (passwordInput.type === 'password') {
passwordInput.type = 'text';
toggleIcon.textContent = 'üôà';
} else {
passwordInput.type = 'password';
toggleIcon.textContent = 'üëÅÔ∏è';
}
}

window.addEventListener('load', function() {
const sesionActiva = localStorage.getItem('usuarioUGC');
if (sesionActiva) {
const usuario = JSON.parse(sesionActiva);
console.log('‚ö†Ô∏è Ya hay una sesi√≥n activa:', usuario);
}
});

document.getElementById('password').addEventListener('keypress', function(e) {
if (e.key === 'Enter') {
document.getElementById('loginForm').dispatchEvent(new Event('submit'));
}
});

console.log('üîê Sistema de login cargado');
</script>

</body>
</html>
